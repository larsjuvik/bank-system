@page "/transactions"
@using BankSystem.Data
@using Data.Models
@using Microsoft.AspNetCore.Authorization
@using Microsoft.EntityFrameworkCore
@attribute [StreamRendering]
@attribute [Authorize]
@inject BankContext BankContext

<PageTitle>Transactions</PageTitle>

<h1>Transactions</h1>

<p>Here you can see your financial transactions</p>

@if (transactions == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
    <thead class="bg-secondary bg-gradient bg-opacity-75">
        <tr>
            <th>Date</th>
            <th>From</th>
            <th>To</th>
            <th>Amount (USD)</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var transaction in transactions)
            {
                <tr class="bg-gradient bg-opacity-25 @(transaction.Amount < 0 ? "bg-danger" : "bg-success")">
                    <td>@transaction.TransactionDate.ToShortDateString()</td>
                    <td>@transaction.From?.Id</td>
                    <td>@transaction.To?.Id</td>
                    <td>@transaction.Amount</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private Transaction[]? transactions = null;

    protected override async Task OnInitializedAsync()
    {
        transactions = BankContext.Transactions
        .Include(t => t.From)
        .Include(t => t.To)
        .ToArray();
    }
}